Вот детализированный конспект по теме "Установка, настройка и управление PostgreSQL", который охватывает основные аспекты, включая установку, подключение, создание БД и файловую структуру.

---

### 1. Установка и запуск PostgreSQL

Существует два основных варианта установки PostgreSQL:
- **Графический установщик** — подходит для большинства пользователей, включает все базовые компоненты.
- **Утилиты командной строки** — используются для гибкой установки и настройки, могут включать:
  - **Использование бинарных файлов** — сборки для различных операционных систем.
  - **Компиляция из исходного кода** — позволяет установить PostgreSQL на специфичные операционные системы или версии, а также при необходимости кастомизировать код.

**Основные компоненты PostgreSQL**:
- **Сервер (postgresql)** — основной процесс, управляющий данными.
- **Клиент (postgresql-client)** — интерфейсы для пользователей (например, psql).
- **Дополнительные модули (contrib)** — предоставляет дополнительные функции и расширения.

**Процесс установки PostgreSQL**:
1. Установить пакеты PostgreSQL с помощью пакета менеджера:
   ```bash
   sudo apt install postgresql-XX postgresql-client-XX
   ```
2. Создать системного пользователя `postgres` и задать переменные окружения (например, `PGDATA` — путь к директории данных PostgreSQL).
3. Инициализация кластера с помощью команды `initdb`:
   ```bash
   initdb -D /path/to/PGDATA
   ```
4. Запустить экземпляр PostgreSQL с помощью одной из команд:
   ```bash
   postgres -D /path/to/PGDATA
   pg_ctl -D /path/to/PGDATA -l logfile start
   sudo service postgresql start
   ```

**Инициализация кластера**:
- `initdb` создает структуру директорий, включая системные базы данных:
  - **postgres** — пользовательская БД, доступная для работы.
  - **template1 и template0** — шаблоны для создания новых баз данных.

### 2. Подключение к базе данных PostgreSQL

Для подключения к базе данных PostgreSQL можно использовать несколько типов клиентов:
- **psql** — стандартный интерактивный терминал PostgreSQL для работы через командную строку.
- **pgAdmin** — графический интерфейс для администрирования баз данных, доступный на Windows, Unix, macOS.
- **libpq** — библиотека для создания клиентов на основе PostgreSQL.

**Подключение к базе данных**:
1. **psql** — простой способ подключиться через терминал:
   ```bash
   psql -h host -p port -U user database
   ```
2. **pg_hba.conf** — конфигурационный файл, где задаются правила подключения. Этот файл включает записи, определяющие, какие пользователи могут подключаться к каким базам данных и с каким типом аутентификации.

**Формат pg_hba.conf**:
- **local** — соединение через UNIX-сокет для локальных клиентов.
- **host** — TCP/IP-соединение для удаленных клиентов.
  
Пример записи:
```plaintext
host    all    all    127.0.0.1/32    md5
```

**Методы аутентификации**:
- **trust** — открытый доступ (не рекомендуется).
- **md5** и **scram-sha-256** — парольная аутентификация.
- **peer** — проверка соответствия пользователя ОС и PostgreSQL.
- **ident** — метод для TCP/IP-соединений, аналогичный `peer` для UNIX-сокетов.

### 3. Создание базы данных

PostgreSQL позволяет создать базу данных следующими способами:
- **CREATE DATABASE** — SQL-команда:
  ```sql
  CREATE DATABASE newDb1;
  ```
- **createdb** — утилита командной строки:
  ```bash
  createdb -h host -p port -U user newDb2
  ```

Для создания базы данных требуется обладать правами суперпользователя или ролью **CREATEDB**. База данных создается путем клонирования шаблона **template1**, но можно использовать другую базу в качестве шаблона:
```sql
CREATE DATABASE newDb3 TEMPLATE otherDB;
```

### 4. Файловая структура и конфигурация PostgreSQL

**Основные директории в PGDATA**:
- **global** — системные таблицы и метаданные.
- **pg_wal** — файлы журналов транзакций (Write-Ahead Log).
- **pg_xact** — хранение данных о состоянии транзакций (коммиты и откаты).
- **base** — директория с данными всех баз данных кластера.

**oid2name** — утилита для отображения имен баз данных по их OID:
```bash
oid2name
```

**Конфигурационные файлы**:
- **postgresql.conf** — основной файл для настройки PostgreSQL. Включает параметры, такие как `shared_buffers` и `search_path`.
- **postgresql.auto.conf** — содержит параметры, изменяемые через `ALTER SYSTEM`.
- **pg_hba.conf** — определяет правила подключения.
- **pg_ident.conf** — позволяет отображать имена пользователей ОС на имена пользователей PostgreSQL.

**Изменение конфигурации**:
- На уровне кластера: `ALTER SYSTEM`.
- На уровне базы данных: `ALTER DATABASE`.
- На уровне пользователя: `ALTER ROLE`.
- Для текущей сессии: `SET`.

### 5. Табличные пространства

**Табличные пространства** позволяют контролировать физическое расположение объектов базы данных на уровне файловой системы. Они полезны для:
- Размещения критически важных данных на быстрых дисках.
- Управления хранением данных на различных физических устройствах.

**Создание табличного пространства**:
```sql
CREATE TABLESPACE newTablespace LOCATION '/diskA/someDir';
```

**Просмотр информации о табличных пространствах**:
- Функция **pg_tablespace_size** возвращает размер пространства:
  ```sql
  SELECT pg_tablespace_size('tablespace_name');
  ```
- В системном каталоге **pg_tablespace** содержится информация о всех созданных пространствах.

**Стандартные табличные пространства**:
- **pg_default** — основное пространство, соответствует директории `base` в PGDATA.
- **pg_global** — хранит глобальные объекты, такие как системные каталоги и роли.

Табличное пространство можно назначить при создании базы данных:
```sql
CREATE DATABASE TestDB TABLESPACE newTablespace;
```

Табличное пространство может быть переназначено для отдельных таблиц или других объектов:
```sql
ALTER TABLE student SET TABLESPACE newTablespace;
```

**Зачем использовать табличные пространства?**
- Возможность распределять данные по разным дискам.
- Улучшение производительности при доступе к критическим данным.

---

Этот конспект охватывает основные аспекты администрирования PostgreSQL, такие как установка, настройка подключения, создание баз данных и управление табличными пространствами.
Вот более детализированный конспект по администрированию СУБД. Он охватывает ключевые понятия, которые могут понадобиться для контрольной, и включает комментарии для лучшего понимания:

---

### 1. Архитектура СУБД

**Модель ANSI-SPARC** предложена комитетом SPARC в 1975 году и используется для создания модульной архитектуры СУБД. Она включает три уровня:

- **Внешний уровень (пользовательский)** — уровень, на котором пользователи взаимодействуют с базой данных, используя интерфейсы, запросы или прикладные программы. Этот уровень предоставляет абстракцию для удобного доступа к данным.
  
- **Концептуальный уровень** — описывает логическую модель данных, структуру связей между данными и целостность данных. Здесь определяются логические объекты, такие как таблицы, индексы и представления.

- **Внутренний уровень (физический)** — отвечает за физическую организацию данных, способы их хранения на диске и оптимизацию производительности.

### 2. PostgreSQL и его структура

**PostgreSQL** — объектно-реляционная СУБД с поддержкой клиент-серверной архитектуры, разрабатываемая с 1986 года. Использует язык SQL, позволяет выполнять сложные запросы и работать с большими объёмами данных. Структура PostgreSQL делится на следующие компоненты:

- **Кластер БД** — совокупность баз данных, управляемых одним экземпляром сервера PostgreSQL. Кластер содержит несколько БД, а также их системные и пользовательские данные.
  
- **Экземпляр (инстанс)** — совокупность процессов PostgreSQL и разделяемой памяти, выполняющих обработку запросов и управление данными кластера.

#### Основные компоненты PostgreSQL:

- **Разделяемое буферное пространство (Shared Buffers)** — служит для временного хранения данных из файлов на диске. Это пространство используется всеми процессами экземпляра для минимизации операций с диском. Настраивается через параметр `shared_buffers` (по умолчанию 128 МБ).

- **Журнал предзаписи (Write-Ahead Log, WAL)** — журнал, записывающий изменения данных перед их применением. WAL используется для обеспечения долговечности (Durability): в случае сбоя сервер может восстановить данные из WAL-файлов. Настраивается параметром `wal_buffers`.

- **Журнал транзакций (CLOG)** — содержит информацию о статусах транзакций (например, завершена ли транзакция или была отменена). Доступен серверным процессам для проверки целостности данных.

- **Пространство блокировок (Lock Space)** — хранит данные о блокировках, используемых для предотвращения одновременного изменения одного и того же объекта несколькими транзакциями.

- **Память процессов** — это область памяти, выделяемая для каждого серверного процесса. Она используется для операций, связанных с запросами (например, ORDER BY или JOIN). Включает `work_mem`, `maintenance_work_mem` и `temp_buffers`.

#### Архитектура серверов в PostgreSQL:

- **Выделенный сервер** — каждый пользовательский процесс имеет свой серверный процесс. Этот режим упрощает управление транзакциями и обработку запросов.

- **Разделяемый сервер** — серверные процессы распределяются между пользовательскими процессами через специальный диспетчер. Этот режим позволяет более эффективно использовать ресурсы при высокой нагрузке.

### 3. Системный каталог PostgreSQL

**Системный каталог** — набор таблиц и представлений, содержащих метаданные о базе данных. Метаданные включают структуру таблиц, индексы, привилегии, а также информацию о пользователях и ролях.

- **pg_database** — информация обо всех базах данных кластера.
  
- **pg_class** — данные о таблицах, представлениях и других объектах.
  
- **pg_tables** — содержит информацию о таблицах текущей базы данных.

Для доступа к метаданным можно использовать стандартный SQL-интерфейс **INFORMATION_SCHEMA**, доступный с версии PostgreSQL 8.0. Примеры запросов:

```sql
SELECT * FROM information_schema.tables;
SELECT * FROM pg_catalog.pg_tables;
```

**Мета-команды psql** — удобный способ просмотра структуры и состояния объектов в PostgreSQL. Примеры команд:
- `\d <таблица>` — отображает структуру таблицы.
- `\di` — показывает индексы.

### 4. Управление доступом к БД

**Права доступа** определяют, какие действия пользователи могут выполнять с объектами базы данных. Эти права назначаются с помощью **привилегий**.

#### Привилегии:
- Привилегии могут быть **системными** (управление базой данных) и **пользовательскими** (работа с таблицами и другими объектами).
- Основные типы привилегий: `SELECT`, `INSERT`, `UPDATE`, `DELETE`, `CREATE`, `EXECUTE`, `CONNECT`, `REFERENCES`.

Примеры:
```sql
GRANT SELECT ON table_name TO user_name;
REVOKE UPDATE ON table_name FROM user_name;
```

#### Владелец объекта
- Пользователь, создавший объект, является его владельцем и по умолчанию получает все права на этот объект. Владелец может передавать свои права другим пользователям или ролям.

### 5. Роли и пользователи

В PostgreSQL **роли** представляют собой именованные наборы привилегий. Роли могут быть назначены пользователям для упрощения управления правами.

- **Системные роли** — такие как `postgres` (администратор) и `public` (назначается всем пользователям по умолчанию).
  
- **Пользовательские роли** — определяются администратором и могут быть настроены с различными правами и параметрами (например, LOGIN, SUPERUSER, CREATEDB, CREATEROLE).

Пример создания роли:
```sql
CREATE ROLE student WITH LOGIN PASSWORD 'password';
GRANT SELECT ON table_name TO student;
```

#### Настройка ролей:

- **LOGIN** — разрешает подключение к базе данных.
- **SUPERUSER** — предоставляет все привилегии на все объекты в кластере.
- **CREATEROLE** — разрешает создание и управление ролями.
- **CREATEDB** — разрешает создание баз данных.

#### Группы ролей и наследование привилегий (INHERIT)
- **INHERIT** — роли наследуют привилегии других ролей, что упрощает управление доступом.
  
Пример:
```sql
CREATE ROLE students;
GRANT students TO student_user;
```

#### Настройка ограничения доступа:
- **CONNECTION LIMIT** — задает максимальное количество подключений для роли.
- **VALID UNTIL** — устанавливает срок действия пароля роли.

### 6. Параметры доступа и пространства поиска

**search_path** — последовательность схем, в которых осуществляется поиск объектов при запросах. Используется для упрощения работы с объектами без указания их полных имен.

Пример:
```sql
SET search_path TO schema1, schema2;
```

**pg_catalog и pg_temp** добавляются в `search_path` по умолчанию, обеспечивая доступ к системным объектам и временным таблицам.

### 7. Работа с привилегиями и группами ролей

Роли можно объединять в группы для более гибкого управления доступом. Группа ролей может иметь администратора, который будет управлять участниками.

- **WITH GRANT OPTION** — разрешает передавать полученные привилегии другим ролям.
  
Пример создания группы ролей:
```sql
CREATE ROLE admins WITH NOLOGIN;
GRANT admins TO admin_user WITH ADMIN OPTION;
```

### 8. Логирование и фоновые процессы

**Фоновые процессы** в PostgreSQL выполняют важные задачи по поддержанию производительности и целостности данных:

- **writer process** — периодически записывает измененные данные из буферов на диск.
- **checkpointer** — создает контрольные точки, фиксируя состояние БД для восстановления.
- **archiver** — копирует созданные WAL-файлы в архив.
- **stats collector** — собирает статистику о выполнении запросов и состоянии базы данных.

### 9. Журналирование транзакций и контрольные точки

**Журналирование транзакций (WAL)** используется для восстановления данных после сбоев. **Контрольные точки** (checkpoint) создаются регулярно для сохранения актуального состояния базы данных на диск. Это позволяет снизить нагрузку на систему при восстановлении.

Настройка:
- `checkpoint_timeout` — интервал между контрольными точками.
- `max_wal_size` — максимальный объем WAL-журнала.

---

Этот расширенный конспект включает ключевые термины и примеры SQL-запросов, что позволит лучше подготовиться к контрольной и понять основные аспекты администрирования СУБД.